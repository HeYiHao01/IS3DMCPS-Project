<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeesite.modules.is3dmcps.dao.IsFaultsDao">
	
	<!-- 查询数据
	<select id="findList" resultType="IsFaults">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select> -->
	<select id="getFaultsCount" resultType="java.lang.Integer" parameterType="String">
		select count(*) from is_faults where ID not in (select faults_id from is_repair_rec where results='2' or results='3') and to_char(faults_time,'yyyy.mm.dd') = #{faultsTime}
	</select>
	<select id="getFaultsDetails" resultType="IsFaults">
		select * from is_faults where ID not in (select faults_id from is_repair_rec where results='2' or results='3')
	</select>
	<select id="getNeedRepair" resultType="IsFaults">
		select * from is_faults where ID in (select faults_id from is_repair_rec where results='0' or results='4')
	</select>
	<select id="getAllFaultsCount" resultType="java.lang.Integer">
		select count(*) from is_faults where ID not in (select faults_id from is_repair_rec where results='2' or results='3')
	</select>
	<select id="getFaultsStateDetails" resultType="IsFaults" parameterType="String">
		select * from is_faults where device_id=#{deviceId} and rownum=1 order by faults_time
	</select>
</mapper>