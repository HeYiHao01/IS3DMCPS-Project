/*! zoom_marker - v0.0.8 - */

!function(a){var b=[];a.fn.extend({zoomMarker:function(b){const e=a(this).attr("id");c(e);var f=d(e),h=f.options,i=f.that,j=f.dialog,k=f.isInit;if(!k){k=!0,f.isInit=k,document.ondragstart=function(){return!1},i=a(this),f.that=i;var l;h=void 0===b?p:a.extend({},p,b),f.options=h,null===h.src?console.log("Image resources is not defined."):g(e,h.src),i.bind("mousewheel",function(a,b){return i.zoomMarker_Zoom({x:a.pageX,y:a.pageY},b>0?1+h.rate:1-h.rate),!1});var m=new Hammer(document.getElementById(a(this).attr("id")));m.on("pan",function(a){h.pinchlock||(j.hide(),i.zoomMarker_Move(a.deltaX+l.left,a.deltaY+l.top))}),m.on("panstart",function(a){l=i.offset()}),m.on("panend",function(a){h.pinchlock=!1}),m.get("pinch").set({enable:!0}),m.on("pinchmove",function(a){j.hide(),i.zoomMarker_Zoom({x:a.center.x,y:a.center.y},a.scale/h.pinchscale),h.pinchscale=a.scale}),m.on("pinchstart",function(a){h.pinchlock=!0,h.pinchscale=1}),j=a("<div id='zoom-marker-hover-dialog' class='zoom-marker-hover-dialog'></div>"),f.dialog=j,i.parent().append(j),new Hammer(document.getElementById(i.attr("id"))).on("tap",function(a){var b=d(e),c=b.options,f=b.that;if(void 0===a.pointers[0].x){var g=f.offset();f.trigger("zoom_marker_mouse_click",{x:(a.center.x-g.left)/f.width()*c.imgNaturalSize.width,y:(a.center.y-g.top)/f.height()*c.imgNaturalSize.height})}else f.trigger("zoom_marker_mouse_click",{pageX:a.pointers[0].offsetX,pageY:a.pointers[0].offsetY,x:a.pointers[0].offsetX/f.width()*c.imgNaturalSize.width,y:a.pointers[0].offsetY/f.height()*c.imgNaturalSize.height})})}},zoomMarker_LoadImage:function(b){const c=a(this).attr("id");g(c,b,!0)},zoomMarker_Zoom:function(b,c){const e=a(this).attr("id");var f=d(e),g=f.options,h=f.that,i=h.offset(),j=h.height(),l=h.width(),m=l*c;null!=g.max&&(m>g.max||m<g.min)||(h.height(j*c),h.width(m),void 0!==b&&null!==b||(b={},b.x=i.left+l/2,b.y=i.top+j/2),h.offset({top:b.y-h.height()*(b.y-i.top)/j,left:b.x-h.width()*(b.x-i.left)/l}),k(e))},zoomMarker_Move:function(b,c){const e=a(this).attr("id");d(e).options.enable_drag&&(a(this).offset({top:c,left:b}),k(e))},zoomMarker_AddMarker:function(b){return j(a(this).attr("id"),b)},zoomMarker_RemoveMarker:function(b){m(a(this).attr("id"),b)},zoomMarker_CleanMarker:function(){l(a(this).attr("id"))},zoomMarker_GetPicSize:function(){const b=a(this).attr("id");return d(b).options.imgNaturalSize},zoomMarker_ImageCenterAlign:function(){h(a(this).attr("id"))},zoomMarker_EnableDrag:function(b){o(a(this).attr("id"),b)}});var c=function(a){void 0===b[a]&&b.push({id:a,options:{imgNaturalSize:{width:0,height:0}},that:null,dialog:null,isInit:!1,markerList:[],markerId:0})},d=function(a){for(var c=0;c<b.length;++c)if(b[c].id===a)return b[c];return null},e=function(a,b){a.onload=null,a.complete?b(f(a)):a.onload=function(){b(f(a))}},f=function(a){if(void 0===a.naturalWidth){var b=new Image;b.src=a.src;var c=b.width,d=b.height}else var c=a.naturalWidth,d=a.naturalHeight;return{width:c,height:d}},g=function(a,b,c){var f=d(a),g=f.options,j=f.that;j.trigger("zoom_marker_img_load",b),j.attr("src",b),e(document.getElementsByName(j.attr("name"))[0],function(b){if(void 0===c||!c){var d=j.width(),e=j.height();null!=g.width&&(j.width(g.width),j.height(j.width()/d*e))}j.trigger("zoom_marker_img_loaded",b),void 0!==c&&c||h(a),g.imgNaturalSize=b,f.options.imgNaturalSize=b,i(a,g.markers)})},h=function(a){var b=d(a),c=b.that,e=c.offset(),f=c.parent(),g=e.top+(f.height()-c.height())/2,h=e.left+(f.width()-c.width())/2;c.offset({top:g>0?g:0,left:h>0?h:0})},i=function(b,c){a(c).each(function(a,c){j(b,c)})},j=function(b,c){var e=d(b),f=e.options,g=e.dialog,h=e.that,i=e.markerId,j=e.markerList,k=a("<div class='zoom-marker'><img draggable='false'><span></span></div>"),l=k.find("img"),m=c.size||f.marker_size;if(c.size=m,l.attr("src",c.src),void 0!==c.hint){var o=k.find("span");o.empty().append(c.hint.value||""),o.css(c.hint.style||{})}l.height(m),l.width(m);var p={id:i++,marker:k,param:c};return e.markerId=i,k.click(function(){void 0!==c.click&&c.click(p),h.trigger("zoom_marker_click",p)}),void 0!==c.dialog&&(k.mousemove(function(a){f.hover_marker_id=p.id,g.empty().append(c.dialog.value||"").css(c.dialog.style||{}).show().offset({left:(c.dialog.offsetX||0)+a.pageX,top:(c.dialog.offsetY||0)+a.pageY})}),k.mouseout(function(a){f.hover_marker_id=null,g.hide()})),h.parent().append(k),j.push(p),e.markerList=j,n(b,k,c,h.offset()),p},k=function(b){var c=d(b),e=c.that,f=e.offset();a(c.markerList).each(function(a,c){n(b,c.marker,c.param,f)})},l=function(b){var c=d(b),e=c.markerList;a(e).each(function(a,b){b.marker.unbind(),b.marker.remove()}),c.markerList=[],c.options.markers=[],c.dialog.hide()},m=function(b,c){var e=d(b),c=e.markerId,f=e.options,g=e.dialog;a(e.markerList).each(function(a,b){if(b.id===c)return b.marker.unbind(),b.marker.remove(),null!=(f.hover_marker_id||null)&&f.hover_marker_id===c&&g.hide(),!1})},n=function(a,b,c,e){var f=d(a);const g=f.that,h=f.options;b.offset({left:g.width()*c.x/h.imgNaturalSize.width+e.left-c.size/2,top:g.height()*c.y/h.imgNaturalSize.height+e.top-c.size})},o=function(a,b){d(a).options.enable_drag=b},p={rate:.2,src:null,width:500,min:300,max:null,markers:[],marker_size:20,enable_drag:!0}}(window.jQuery);